# Github Actions for libiGL
`last update: Feb 05 2020`

`.github/workflows` contains two workflows for `libigl`. This document outlines the current status of the CI project as well as the tools/dependencies used for caching, testing, etc for the two workflows:
- `daily.yml`
- `continuous.yml`

Some notes from Jeremie:
- Disk space limit of 16 GB on GitHub Actions
- Timout is 6h (AppVeyor is 1h).
- Caching still has some strict space limits (400 MB per job, 2 GB total accross all jobs). 
So it's not ideal but if we limit builds to Release configurations we should stay under this space limit.
- Tutorials are disabled on Windows in Debug mode, since .pdb information generated by MSVC is gigantic and goes over the space limit.

### Outstanding questions
- DLIBIGL_BUILD_TUTORIALS: why is this only for Windows in `daily.yml`?
- I successfully made a build with both Debug and Release in `continuous.yml` but it took 45min. Do we want to still keep this for PR/pushes?
- 

## Scheduled Workflow:  `daily.yml`

### Dependencies

#### Linux Dependencies
- libblas-dev 
- libboost-filesystem-dev 
- libboost-system-dev 
- libboost-thread-dev
- libglu1-mesa-dev 
- liblapack-dev 
- libmpfr-dev 
- xorg-dev

#### macOS Dependencies
- boost gmp mpfr

#### Windows Dependencies
None

## PR Workflow: `continuous.yml`
This build is the same as `daily.yml` except it uses caching:

### Actions

#### Unix Actions
`actions/checkout@v1`
- Uses `fetch-depth` to specify the number of commits to fetch when cloning the repo

`actions/cache@v1`
- https://github.com/actions/cache
- https://help.github.com/en/actions/automating-your-workflow-with-github-actions/caching-dependencies-to-speed-up-workflows
- Allows for caching dependencies and outputs to improve workflow execution time

#### Windows Actions
`actions/checkout@v1` 
- With `seanmiddleditch/gha-setup-ninja@master` which installs ninja into `PATH` for the job. It downloads the official `ninja` binaries.

### Caching

#### Unix Caching
```
    ...
    - name: Cache Build
    id: cache-build
    uses: actions/cache@v1
    with:
        path: ~/.ccache
        key: ${{ runner.os }}-${{ matrix.config }}-${{ matrix.static }}-cache

    - name: Prepare ccache
    run: |
        ccache --max-size=1.0G
        ccache -V && ccache --show-stats && ccache --zero-stats
    ...
```
<!-- - Caching is limited to 400MB per job  -->
- From docs: "<b>A repository can have up to 5GB of caches</b>. Once the 5GB limit is reached, older caches will be evicted based on when the cache was last accessed. Caches that are not accessed within the last week will also be evicted."

#### Windows Caching
```
    - name: Cache build
    id: cache-build
    uses: actions/cache@v1
    with:
        path: ${{ env.appdata }}\Mozilla\sccache
        key: ${{ runner.os }}-${{ matrix.config }}-${{ matrix.static }}-cache

    - name: Prepare sccache
    run: |
        Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')
        scoop install sccache --global
        # Scoop modifies the PATH so we make the modified PATH global.
        echo "::set-env name=PATH::$env:PATH"
```
 

## Glossary
#### `ccache`
- used for optimizing compilations
#### `sccache`
- Faciliated with https://github.com/mozilla/sccache which is a `ccache`-like tool 
- Currently only used for Windows job in `continuous.yml`
#### MSVC
-
#### `ninja`
- A lightweight build system, built via `cmake`
- https://github.com/ninja-build/ninja
#### LLVM
- Only in `daily.yml`, in the 'Dependencies' step we install the official LLVM 9 repo since it is not by default in Bionic (Ubuntu 18.04)'s repositories.

## Billing
- 